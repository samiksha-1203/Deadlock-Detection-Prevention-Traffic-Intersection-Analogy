<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deadlock Detection & Prevention - OS Project</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon/favicon.ico">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš¦ Deadlock Detection & Prevention Simulator (Traffic Intersection Analogy) ğŸš—ğŸ’»</h1>
            <p class="subtitle">Operating Systems - Resource Allocation Graphs & Banker's Algorithm</p>
            
            <div class="mode-selector">
                <h3 class="mode-header">ğŸ® Simulation Mode</h3>
                <div class="mode-buttons">
                    <button class="mode-btn active" data-mode="detection">
                        <span class="mode-icon">ğŸ”´</span>
                        <span class="mode-name">Detection</span>
                        <span class="mode-desc">Allows all requests, detects cycles</span>
                    </button>
                    <button class="mode-btn" data-mode="avoidance">
                        <span class="mode-icon">ğŸŸ¢</span>
                        <span class="mode-name">Avoidance (Banker's)</span>
                        <span class="mode-desc">Checks safe state before allowing</span>
                    </button>
                    <button class="mode-btn" data-mode="prevention">
                        <span class="mode-icon">ğŸŸ¡</span>
                        <span class="mode-name">Prevention</span>
                        <span class="mode-desc">Uses resource ordering (Nâ†’Eâ†’Sâ†’W)</span>
                    </button>
                </div>
                <button class="btn-toggle-dark" id="darkModeToggle">ğŸŒ™ Toggle Dark Mode</button>
            </div>
        </header>

        <!-- ROW 1: Intersection + RAG + Controls (sidebar) -->
        <div class="main-grid">
            <!-- Left Side: Intersection + RAG + Coffman -->
            <div class="left-content">
                <!-- ROW 1: Intersection + RAG -->
                <div class="row-1-grid">
                    <div class="panel intersection-panel">
                        <h3>Traffic Intersection Model</h3>
                        <div class="intersection-container" id="intersection">
                            <div class="road road-vertical"></div>
                            <div class="road road-horizontal"></div>
                            <div class="intersection-center">INTERSECTION<br>(Shared Resource)</div>
                            
                            <div class="lane-marker lane-north">R_North</div>
                            <div class="lane-marker lane-south">R_South</div>
                            <div class="lane-marker lane-east">R_East</div>
                            <div class="lane-marker lane-west">R_West</div>
                        </div>
                    </div>

                    <div class="panel">
                        <h3>Resource Allocation Graph (RAG)</h3>
                        <canvas id="ragCanvas" class="rag-canvas"></canvas>
                    </div>
                </div>

                <!-- ROW 2: Coffman Conditions (small height) -->
                <div class="panel coffman-panel">
                    <h3>Deadlock Conditions (Coffman Conditions)</h3>
                    <div class="coffman-grid">
                        <div class="condition-box" id="cond1">
                            <div class="condition-title">1. Mutual Exclusion âœ“</div>
                            <div class="condition-desc">Resources cannot be shared - only one process at a time</div>
                        </div>
                        <div class="condition-box" id="cond2">
                            <div class="condition-title">2. Hold and Wait</div>
                            <div class="condition-desc">Process holds resources while waiting for others</div>
                        </div>
                        <div class="condition-box" id="cond3">
                            <div class="condition-title">3. No Preemption âœ“</div>
                            <div class="condition-desc">Resources cannot be forcefully taken away</div>
                        </div>
                        <div class="condition-box" id="cond4">
                            <div class="condition-title">4. Circular Wait</div>
                            <div class="condition-desc">Circular chain of processes waiting for resources</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar: Controls (spans down) -->
            <div class="panel controls-sidebar">
                <h3>Controls</h3>
                
                <h4 class="section-title">Add Processes (Cars)</h4>
                <div class="direction-grid">
                    <button class="btn btn-add" data-direction="north">ğŸ”µ North</button>
                    <button class="btn btn-add" data-direction="south">ğŸ”´ South</button>
                    <button class="btn btn-add" data-direction="east">ğŸŸ¢ East</button>
                    <button class="btn btn-add" data-direction="west">ğŸŸ¡ West</button>
                </div>
                
                <h4 class="section-title">Algorithms & Actions</h4>
                <button class="btn btn-detect" id="detectBtn">ğŸ” Detect Deadlock (RAG)</button>
                <button class="btn btn-banker" id="bankerBtn">ğŸ’š Run Banker's Algorithm</button>
                <button class="btn btn-advance" id="advanceBtn">â–¶ï¸ Advance Cars</button>
                <button class="btn btn-reset" id="resetBtn">ğŸ”„ Reset Simulation</button>

                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="carCount">0</div>
                        <div class="stat-label">Active Processes</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="deadlockCount">0</div>
                        <div class="stat-label">Deadlocks Detected</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="completedCount">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="deniedCount">0</div>
                        <div class="stat-label">Denied Requests</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROW 3: Prevention Techniques + Event Log + Banker's -->
        <div class="row-3-grid">
            <div class="panel">
                <h3>ğŸ›¡ï¸ Deadlock Prevention Techniques</h3>
                <div class="prevention-panel">
                    <div class="prevention-technique">
                        <div class="technique-header">
                            <span class="technique-icon">ğŸš¦</span>
                            <span class="technique-name">Traffic Signals / Police Control</span>
                        </div>
                        <div class="technique-breaks">Breaks: Hold & Wait + Circular Wait</div>
                        <div class="technique-desc">Cars must stop at red, not enter intersection until they fully pass</div>
                    </div>
                    
                    <div class="prevention-technique">
                        <div class="technique-header">
                            <span class="technique-icon">ğŸ“‹</span>
                            <span class="technique-name">Priority / Direction Ordering</span>
                        </div>
                        <div class="technique-breaks">Breaks: Circular Wait</div>
                        <div class="technique-desc">Example: N(0) â†’ E(1) â†’ S(2) â†’ W(3) fixed priority ordering</div>
                    </div>
                    
                    <div class="prevention-technique">
                        <div class="technique-header">
                            <span class="technique-icon">ğŸ”’</span>
                            <span class="technique-name">Full Path Reservation</span>
                        </div>
                        <div class="technique-breaks">Breaks: Hold & Wait</div>
                        <div class="technique-desc">No car enters unless full path is free - all-or-nothing allocation</div>
                    </div>
                    
                    <div class="prevention-technique">
                        <div class="technique-header">
                            <span class="technique-icon">â¡ï¸</span>
                            <span class="technique-name">One-way Roads</span>
                        </div>
                        <div class="technique-breaks">Breaks: Circular Wait</div>
                        <div class="technique-desc">Remove circular dependencies completely - unidirectional flow</div>
                    </div>
                    
                    <div class="prevention-technique">
                        <div class="technique-header">
                            <span class="technique-icon">ğŸš›</span>
                            <span class="technique-name">Preemption (Rare)</span>
                        </div>
                        <div class="technique-breaks">Breaks: No Preemption</div>
                        <div class="technique-desc">Tow truck or reverse rule to clear lane (force resource release)</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>Event Log</h3>
                <div class="log-panel" id="logPanel"></div>
            </div>

            <div class="panel">
                <h3>Banker's Algorithm Matrices</h3>
                <div id="bankerDisplay" class="banker-display">
                    <em>Run Banker's Algorithm to see allocation matrices...</em>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <h3>â„¹ï¸ How It Works</h3>
            <div class="info-content">
                <p><strong>Model Mapping:</strong></p>
                <ul>
                    <li>ğŸš— <strong>Cars = Processes</strong> (P1, P2, P3, P4)</li>
                    <li>ğŸ›£ï¸ <strong>Lanes = Resources</strong> (R_North, R_South, R_East, R_West) - Single instance each</li>
                    <li>âš¡ <strong>Each car needs 2 resources:</strong> Entry lane + Exit lane to complete journey</li>
                </ul>
                
                <p><strong>Three Modes:</strong></p>
                <ul>
                    <li>ğŸ”´ <strong>Detection Mode:</strong> Allows all requests, then detects deadlock using RAG cycle detection</li>
                    <li>ğŸŸ¢ <strong>Avoidance Mode (Banker's):</strong> Checks if granting request keeps system in safe state before allowing</li>
                    <li>ğŸŸ¡ <strong>Prevention Mode:</strong> Uses resource ordering (Nâ†’Eâ†’Sâ†’W) to prevent circular wait</li>
                </ul>

                <p><strong>Key Concepts:</strong></p>
                <ul>
                    <li><strong>Max Matrix:</strong> Declared upfront - each car declares its full resource need (entry + exit lane)</li>
                    <li><strong>Safe State:</strong> A state where there exists a sequence to complete all processes</li>
                    <li><strong>Resource Ordering:</strong> If all processes request resources in the same order, no circular wait can form</li>
                </ul>
                
                <p><strong>Testing Instructions:</strong></p>
                <ul>
                    <li><strong>Detection:</strong> Add North, East, South, West â†’ Click "Detect Deadlock" â†’ See cycle</li>
                    <li><strong>Avoidance:</strong> Add 3 cars â†’ Try 4th â†’ Gets denied (unsafe state)</li>
                    <li><strong>Prevention:</strong> Add North, East, South â†’ Try West â†’ Denied (violates ordering 3â†’0)</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="js/script.js"></script>
</body>
</html>